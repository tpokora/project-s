create database project_s_db;

USE project_s_db;

create user 'project-s-app'@'localhost' identified by 'password';

grant select, insert, update, delete on project_s_db.* to 'project-s-app'@'localhost';

CREATE TABLE USERS (
  ID INT(11) NOT NULL AUTO_INCREMENT,
  USERNAME VARCHAR(45) COLLATE utf8_polish_ci NOT NULL,
  PASSWORD VARCHAR(64) COLLATE utf8_polish_ci NOT NULL,
  EMAIL VARCHAR(255) COLLATE utf8_polish_ci NOT NULL,
  ROLE VARCHAR(45) COLLATE utf8_polish_ci DEFAULT 'ROLE_USER',
  PRIMARY KEY (ID),
  UNIQUE KEY USERNAME_UNIQUE (USERNAME),
  UNIQUE KEY EMAIL_UNIQUE (EMAIL)
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci;

ALTER TABLE USERS AUTO_INCREMENT=1000;

INSERT INTO USERS(USERNAME, PASSWORD, EMAIL, ROLE)
    VALUES ('admin', '$2a$10$RiDTA930W5o8lpeNbQc1/.1jDubtN7gLDmzUR4OrhMob8BDuW54J6', 'email@email.com', 'ROLE_ADMIN');

CREATE TABLE ARTICLE (
	ID INT(11) PRIMARY KEY NOT NULL AUTO_INCREMENT,
	TITLE VARCHAR(64) NOT NULL COLLATE utf8_polish_ci,
    CONTENT BLOB NOT NULL,
    CREATE_TIME DATETIME NOT NULL DEFAULT NOW(),
    USER_ID INT(11) NOT NULL,
    FOREIGN KEY (USER_ID)
		REFERENCES USER (ID)
        ON DELETE CASCADE
        ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_polish_ci;

ALTER TABLE ARTICLE AUTO_INCREMENT=1000;

CREATE TABLE RESET_PASSWORD_SESSION (
    ID INT(11) PRIMARY KEY NOT NULL AUTO_INCREMENT,
    SESSIONID VARCHAR(36) NOT NULL,
    TEMP_PASSWORD VARCHAR(60) NOT NULL,
    OLD_PASSWORD VARCHAR(60) NOT NULL,
    CREATE_TIME DATETIME NOT NULL DEFAULT NOW(),
    USER_ID INT(11) NOT NULL,
    FOREIGN KEY (USER_ID)
    		REFERENCES USER (ID)
            ON DELETE CASCADE
            ON UPDATE CASCADE
);

ALTER TABLE RESET_PASSWORD_SESSION ADD UNIQUE USER_SESSION_INDEX (SESSIONID, USER_ID);